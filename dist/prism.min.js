function Board(a){var b="undefined"!=typeof window?window.Events:{emit:function(){}};this.score=0,this.isGameOver=!1,this.resetGrid=function(){this.grid=_.map(Array(4),function(){return _.map(Array(4),function(){return 0})})},a?this.grid=a:this.resetGrid(),this.newGame=function(a){if(this.resetGrid(),a){var c=this;_.forEach(a,function(a){c.spawn(a[0],a[1],a[2])})}else this.spawn(),this.spawn();this.score=0,b.emit("score",this.score),this.isGameOver=!1},this.lastVisited=[],this.hasAnotherMove=function(){for(var a=0;4>a;a++)for(var b=0;4>b;b++){if(!this.grid[a][b])return!0;var c=[[-1,0],[1,0],[0,-1],[0,1]],d=this;if(_.some(c,function(c){return d.grid[a+c[0]]&&d.grid[a][b]===d.grid[a+c[0]][b+c[1]]}))return!0}return!1},this.sampleWithout=function(a,b){for(var c=[],d=0;d<a.length;d++){for(var e=a[d],f=0;f<b.length;f++){var g=b[f];if(_.isEqual(e,g))break}f===b.length&&c.push(e)}return _.sample(c)},this.spawn=function(a,c,d){if(!this.hasAnotherMove())return this.endGame();if(!a&&!c){var e=this.randomSpawn();a=e[0],c=e[1],d=Math.random()<.1?2:1}return this.lastVisited.push([a,c]),this.grid[a][c]=d,b.emit("spawn",{row:a,col:c,color:d}),[a,c]},this.randomSpawn=function(){for(var a=[],b=0;4>b;b++)for(var c=0;4>c;c++)this.grid[b][c]||a.push([b,c]);if(a.length){var d=this.sampleWithout(a,this.lastVisited);return d||(d=_.sample(a)),d}},this.endGame=function(){this.isGameOver=!0,b.emit("gameOver")},this.move=function(a){if(!this.isGameOver){if(GAME.tutorial&&GAME.tutorial.nextStep(),this._move(a),!this.hasAnotherMove())return this.endGame();0!==this.lastVisited.length&&this.spawn(),_.contains(_.flatten(this.grid),10)&&this.endGame()}},this._move=function(a){var c={up:[-1,0],down:[1,0],left:[0,-1],right:[0,1]},d=this.grid,e=c[a],f=_.range(0,4),g=_.range(0,4);"down"===a&&f.reverse(),"right"===a&&g.reverse(),this.lastVisited=[];for(var h=0;4>h;h++)for(var i=0;4>i;i++){var j=f[h],k=g[i],l=j,m=k;if(d[j]&&d[j][k]){for(var n=d[j][k];d[j+e[0]]&&(0===d[j+e[0]][k+e[1]]||d[j][k]===d[j+e[0]][k+e[1]]);)n=d[j][k],d[j][k]===d[j+e[0]][k+e[1]]&&(n=d[j][k]+1+Math.random()/2,this.score+=Math.pow(2*d[j][k],2)),this.lastVisited.push([j,k]),d[j][k]=0,j+=e[0],k+=e[1],d[j][k]=n;b.emit("score",this.score),b.emit("move",{fromRow:l,toRow:j,fromCol:m,toCol:k}),b.emit("setColor",{row:j,col:k,color:Math.floor(n)})}}for(var h=0;4>h;h++)for(var i=0;4>i;i++)this.grid[h][i]=Math.floor(this.grid[h][i])}}function sizing(){var a=window.innerWidth,b=window.innerHeight-2*$(".grid-inner")[0].offsetTop,c=Math.min(a,b);$(".grid-background")[0].style.width=c+"px",$(".grid-background")[0].style.height=c-14+"px"}function Tutorial(a){var b="undefined"!=typeof window?window.Events:{emit:function(){}};this.steps=[{message:"Swipe any direction to move tiles",x:25*a[1]+"%",y:25*a[0]+"%",position:"absolute"},{message:"Combine same-color tiles to make a new color",x:"35%",y:"10%",position:"absolute",noarrow:!0},{message:"Your progress is shown on this bar",x:"50%",y:"10px",position:"fixed"},{message:"You win by making the full rainbow",x:"50%",y:"10px",position:"fixed"}],this.currentStep=-1,this.removeCurrentTip=function(){var a=document.getElementById("tip");a&&a.parentNode.removeChild(a)},this.nextStep=function(a,c){if(this.currentStep++,!this.steps[this.currentStep])return void this.closeTutorial();this.removeCurrentTip();var d=document.createElement("div");d.id="tip";var a=this.steps[this.currentStep].x,c=this.steps[this.currentStep].y,e=this.steps[this.currentStep].noarrow,f=-1!==c.indexOf("%")&&parseInt(c)>=50?"bottom":"top";"bottom"==f?d.style.bottom=100-parseInt(c)+"%":d.style.top=-1!==c.indexOf("%")?25+parseInt(c)+"%":c;var g=a.indexOf("%")!==!1&&parseInt(a)>=50?"right":"left";"right"==g?d.style.right=75-parseInt(a)+"%":d.style.left=a.indexOf("%")!==!1?parseInt(a)+"%":a,d.style.position=this.steps[this.currentStep].position;var h=document.createElement("div");h.innerHTML=this.steps[this.currentStep].message;var i=document.createElement("div"),j=document.createElement("div");e&&(i.style.display="none",j.style.display="none"),"bottom"==f?(i.className="arrow-bottom",j.className="arrow-bottom-border"):(i.className="arrow-top",j.className="arrow-top-border"),d.appendChild(h),d.appendChild(j),d.appendChild(i),$(".grid-background")[0].appendChild(d),b.emit("nextStep",{})},this.closeTutorial=function(){this.removeCurrentTip()},this.nextStep()}Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),"undefined"!=typeof module&&(module.exports=Board),function(){var a,b,c={},d=0;this.Events={on:function(a,b,d){c[a]=c[a]||[],c[a].push({f:b,c:d})},off:function(b,e){if(a=c[b]||[],!e)return a.length=0;for(d=a.length;0<=--d;)e==a[d].f&&a.splice(d,1)},emit:function(){for(b=Array.apply([],arguments),a=c[b.shift()]||[],b=b[0]instanceof Array&&b[0]||b,d=a.length;0<=--d;)a[d].f.apply(a[d].c,b)}}}();var $=document.querySelectorAll.bind(document),GAME={board:new Board},$grid=$(".grid")[0];Events.on("move",function(a){if(a.fromRow!==a.toRow||a.fromCol!==a.toCol){for(var b=$(".tile-"+a.fromRow+"-"+a.fromCol),c=$(".tile-"+a.toRow+"-"+a.toCol)[0],d=0;d<b.length;d++)b[d].className=b[d].className.replace(/tile-\d-\d/,"tile-"+a.toRow+"-"+a.toCol);c&&setTimeout(function(){try{for(var a=0;a<b.length;a++)b[a].parentElement.removeChild(b[a])}catch(c){}},1e3)}}),Events.on("spawn",function(a){var b=document.createElement("div"),c=document.createElement("div");c.setAttribute("class","tile tile-"+a.row+"-"+a.col+" tile-phase-"+(a.color-1)),c.appendChild(b),$grid.appendChild(c)});var maxColor=1;Events.on("setColor",function(a){var b=$(".tile-"+a.row+"-"+a.col);try{for(var c=0;c<b.length;c++)b[c].className=b[c].className.replace(/tile-phase-\d/,"tile-phase-"+(a.color-1));a.color>maxColor&&(maxColor=a.color,$progress=$("#progress-cover")[0],$progress.className=$progress.className.replace(/progress-\d/,"progress-"+(maxColor-1)))}catch(d){}});var gameOverOnce=!1;Events.on("gameOver",function(){maxColor=0;var a=document.getElementById("info-screen");a.className="show";var b=document.getElementById("game-over-box");b.style.display="block";var c=document.createElement("button");c.innerText="Challenge a Friend",c.addEventListener("click",function(){Events.emit("challengeFriend")});var d=$(".bubble-wrapper")[0];if(d&&b.appendChild(d),!gameOverOnce){var e=document.createElement("button");e.innerText="Play Again",e.className="play-again",e.addEventListener("click",function(){Events.emit("restartGame")}),b.appendChild(c),b.appendChild(e),gameOverOnce=!0}}),Events.on("challengeFriend",function(){var a=GAME.board.score;Clay.Social.smartShare({message:"I just scored "+a+" in Prism! Think you can beat my score?",title:"Prism",link:"http://prism.clay.io",ignoreScreenshot:!0,data:{}})}),Events.on("restartGame",function(){$(".grid")[0].innerHTML="",document.getElementById("progress-cover").className="progress-0",document.getElementById("info-screen").className="hide",($scoreWrapperEle=$(".bubble-wrapper")[0])&&document.body.appendChild($scoreWrapperEle),GAME.board.newGame()}),$scoreEle=$("#score")[0],Events.on("score",function(a){$scoreEle.innerHTML=a});var move="left";Hammer(window,{drag_min_distance:5,drag_block_horizontal:!0,drag_block_vertical:!0}).on("dragleft",function(a){a.preventDefault(),a.gesture.preventDefault(),move="left"}).on("dragright",function(a){a.preventDefault(),a.gesture.preventDefault(),move="right"}).on("dragup",function(a){a.preventDefault(),a.gesture.preventDefault(),move="up"}).on("dragdown",function(a){a.preventDefault(),a.gesture.preventDefault(),move="down"}).on("dragend",function(){GAME.board.move(move)}),Mousetrap.bind(["up","down","left","right"],function(a){GAME.board.move(a.keyIdentifier.toLowerCase())}),localStorage["tutorial-shown"]?GAME.board.newGame():(GAME.board.newGame([[2,1,1],[2,2,1]]),GAME.tutorial=new Tutorial([2,1]),localStorage["tutorial-shown"]=1),window.addEventListener("load",function(){if(cards.kik){var a=document.createElement("a");a.className="kik-share",a.href="#",a.innerHTML="<img src='images/kik-it.png'><span>share!</span></a>",a.addEventListener("touchstart",function(){Clay.Kik.post({message:"Come play Prism, the most addicting game on Kik!",title:"Prism",data:{}})}),document.getElementById("share").appendChild(a)}else{var b='<iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fprism.clay.io&amp;send=false&amp;layout=button_count&amp;width=100&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21&amp;appId=405599259465424" style="border:none; overflow:hidden; width: 90px; height:21px;"></iframe>';b+='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="https://platform.twitter.com/widgets/tweet_button.html?url=http://prism.clay.io&via=claydotio&text=Prism%20-%202048%20without%20numbers" style="width:85px; height:20px;"></iframe>',document.getElementById("share").innerHTML=b}}),sizing(),$grid.style.visibility="visible",$(".grid-background")[0].style.visibility="visible",window.onresize=sizing,"undefined"!=typeof module&&(module.exports=Tutorial);
//# sourceMappingURL=prism.min.map